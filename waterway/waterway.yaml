## Waterways Oasis

sensor:
  - platform: command_line
    name: pool
    json_attributes:
      - Pump
      - PumpSpeed
      - Mode
      - PoolTemp
      - AirTemp
      - SolarTemp
      - SetTemp
      - Heat
      - aux1
      - aux2
      - aux3
      - aux4
      - aux5
      - aux6
      - aux7
      - aux8
      - aux9
      - j1
      - j2
      - j3
      - j4
    command: "/config/waterway/json.sh"
    value_template: "{{ value_json.Pool }}"
    scan_interval: "6"
  - platform: template
    sensors:
      pool_temp:
        value_template: "{{ state_attr('sensor.pool', 'PoolTemp')|float }}"
        friendly_name: "Pool Temp"
        device_class: "temperature"
        unit_of_measurement: "째"
      air_temp:
        value_template: "{{ state_attr('sensor.pool', 'AirTemp')|float }}"
        friendly_name: "Air Temp"
        device_class: "temperature"
        unit_of_measurement: "째"
      solar_temp:
        value_template: "{{ state_attr('sensor.pool', 'SolarTemp')|float }}"
        friendly_name: "Solar Temp"
        device_class: "temperature"
        unit_of_measurement: "째"
      pump_speed:
        value_template: "{{ state_attr('sensor.pool', 'PumpSpeed')|int  }}"
        friendly_name: "Pump Speed"
        unit_of_measurement: "%"
        icon_template: "mdi:pump"

binary_sensor:
  - platform: template
    sensors:
      pool_intake_valve:
        friendly_name: "Intake Valve"
        value_template: "{{ is_state_attr('sensor.pool', 'j1', '1') }}"
        icon_template: mdi:relation-many-to-zero-or-one
      pool_return_valve:
        friendly_name: "Return Valve"
        value_template: "{{ is_state_attr('sensor.pool', 'j2', '1') }}"
        icon_template: mdi:relation-one-to-zero-or-many

input_number:
  pool_settemp:
    name: Pool Set Temp
    min: 74
    max: 99
    step: 1
    unit_of_measurement: "째"
    mode: slider
    icon: "mdi:thermometer"

shell_command:
  set_pool_temp: "/config/waterway/setpool.sh settemp {{ states('input_number.pool_settemp') }}"
  off_mode: "/config/waterway/setpool.sh poolmode {{ ((state_attr('sensor.pool','Mode')|int*-1)+0)%4 }}"
  pool_mode: "/config/waterway/setpool.sh poolmode {{ ((state_attr('sensor.pool','Mode')|int*-1)+1)%4 }}"
  spillover_mode: "/config/waterway/setpool.sh poolmode {{ ((state_attr('sensor.pool','Mode')|int*-1)+2)%4 }}"
  spa_mode: "/config/waterway/setpool.sh poolmode {{ ((state_attr('sensor.pool','Mode')|int*-1)+3)%4 }}"

rest_command:
  spa_light:
    url: "http://192.168.22.5/index.htm?txtValue=%24A0%2C6%2C02%2C%21%2CAA%2C55"
  pool_heat:
    url: "http://192.168.22.5/index.htm?txtValue=%24A0%2C6%2C15%2C%21%2CAA%2C55"
  pool_solar:
    url: "http://192.168.22.5/index.htm?txtValue=%24A0%2C6%2C0D%2C%21%2CAA%2C55"


switch:
  - platform: template
    switches:
      spa_light:
        friendly_name: "Spa Light"
        value_template: "{{ is_state_attr('sensor.pool', 'aux1', '1') }}"
        turn_on:
          - service: rest_command.spa_light
        turn_off:
          - service: rest_command.spa_light
        icon_template: mdi:lightbulb
      pool_mode:
        friendly_name: "Pool"
        value_template: "{{ is_state('sensor.pool', 'Pool') }}"
        turn_on:
          - service: shell_command.pool_mode
        turn_off:
          - service: shell_command.off_mode
        icon_template: "mdi:waves"
      spillover_mode:
        friendly_name: "Spillover"
        value_template: "{{ is_state('sensor.pool', 'Spillover') }}"
        turn_on:
          - service: shell_command.spillover_mode
        turn_off:
          - service: shell_command.off_mode
        icon_template: "mdi:archive-arrow-down-outline"
      spa_mode:
        friendly_name: "Spa"
        value_template: "{{ is_state('sensor.pool', 'Spa') }}"
        turn_on:
          - service: shell_command.spa_mode
        turn_off:
          - service: shell_command.off_mode
        icon_template: "mdi:hot-tub"
      pool_heat:
        friendly_name: "Heat"
        value_template: "{{ is_state_attr('sensor.pool', 'Heat', '1') }}"
        turn_on:
          - service: rest_command.pool_heat
        turn_off:
          - service: rest_command.pool_heat
        icon_template: "mdi:hot-tub"
      pool_solar:
        friendly_name: "Pool Solar"
        value_template: "{{ is_state_attr('sensor.pool', 'j3', '1') }}"
        turn_on:
          - service: rest_command.pool_solar
        turn_off:
          - service: rest_command.pool_solar
        icon_template: "mdi:weather-sunny"
